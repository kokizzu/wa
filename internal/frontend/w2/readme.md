# w2: 凹语言中文版的第2版设计

w2为临时名字, 是wz的象形替代. 设计思路参考凹语言中文第一版语法/考鼎码和其他语言的一些设计. 目标是通过内置的数据结构和基本的控制流语句方便编程启蒙, 同时能够融合凹语言的生态.

## 文件名和包结构

- 文件后缀名为`.w2`, 正式版会改成 `.wz`
- 单个文件可执行, 和凹语言保持一致
- 目录中多个`.w2`文件对应一个包
- 源文件以utf8编码

## 主函数

通过`算始`/`算终` 定义主入口函数：

```w2
算始 世界你好
    输出 ("Hello, world!")
算终
```

等价于以下的凹语言代码:

```wa
func main {
    世界你好()
}

func 世界你好 {
    println("Hello, world!")
}
```

## 典型示例

凹语言中文版本更多的是控制流和关键字的中文化, 以下是猜数字的例子:

```
算始 数数游戏必胜()
    // 实际调用的是 `输入()` 函数，要添加括号；
    // `整数()` 函数用于将输入字符串转成整数。
    x := 整数(输入())

    若始 (x % 7 == 0)
        // 实际调用的是 `执行()` 函数，功能名称（"拍手"）作为参数传入。
        执行("拍手")
        终止()    // 调用 `终止()` 函数终止算法的执行。
    若否
        y := x
        当始 (y != 0)
            y := y / 10
            r := y % 10
            若始 (r == 7)
                执行("拍手")
                终止()
            若终
        当终

        // 要给 `执行()` 函数传递两个参数。
        // 第一个参数是需要调用的系统功能名称（"说出"），
        // 第二个参数是执行说出功能需要的参数。
        执行("说出", x)
    若终
算终
```

等价于以下的凹语言程序:

```wa
func main {
    数数游戏必胜()
}

func 数数游戏必胜 {
    // 实际调用的是 `输入()` 函数，要添加括号；
    // `整数()` 函数用于将输入字符串转成整数。
    x := 整数(输入())

    if x % 7 == 0 {
        // 实际调用的是 `执行()` 函数，功能名称（"拍手"）作为参数传入。
        执行("拍手")
        终止()    // 调用 `终止()` 函数终止算法的执行。
    } else {
        y := x
        for y != 0 {
            y := y / 10
            r := y % 10
            if r == 7 {
                执行("拍手")
                终止()
            }
        }

        // 要给 `执行()` 函数传递两个参数。
        // 第一个参数是需要调用的系统功能名称（"说出"），
        // 第二个参数是执行说出功能需要的参数。
        执行("说出", x)
    }
}
```

## 算法的参数及返回值

算法可以带参数, 参数可以由命令行或者平台实现, 类型为字符串.

```
算始 转换进制 (x, b)
    x := 整数(x)
    b := 整数(b)

    若始 (b <= 1)
        返回 未定义
    若终

    s := []
    若始 (x = 0)
        s := [0]
    若否
        当始 (x != 0)
            r := x % b
            s := [r] + s
            x := x // b
        当终
    若终

    返回 s
算终
```

等价于以下的凹语言程序:

```wa
import "os"

func main {
    println(转换进制(os.Args[1], os.Args[2]))
}

func 转换进制 (x, b: string) => string {
    x := 整数(x)
    b := 整数(b)

    if b <= 1 {
        return 未定义.String()
    }

    // 列表元素默认为整数类型
    // 列表和字典精确类型的定义还需要细化
    s := []int{}
    if (x = 0) {
        s := [0]
    } else {
        for x != 0 {
            r := x % b
            s := [r] + s // 列表支持添加运算符
            x := x / b
        }
    }

    // 列表的序列化(需要底层支持)
    return s.String()
}
```

## 字典及操作

| 操作 | 运算符/函数 | 示例 | 结果
| ---- | ---------- | ---- | ----
| 定义映射 | `:=` | `map := {"姓名": "张三", "年龄": 7}` | `map` 是包含两个键值对的映射。
| 获取长度 | `长度()` | `len := 长度(map)` | `len` 的值为 `2` （键值对个数）。
| 合并两个映射 | `+` | `map := {"姓名": "张三"} + { "年龄": 7}` | `map` 包含两个键值对，如有相同键名，后者覆盖前者。
| 获取键序列 | `.键序列/keys()` | `keys := map.键序列()` | `keys` 的值为 `["姓名", "年龄"]`。
| 获取值序列 | `.值序列/values()` | `values := map.值序列()` | `values` 为 `["张三", 7]`。
| 设置键值 | `:=` | `map["姓名"] := "李四"` | `map` 被改变。
| 访问键值 | `[]` | `name := map["姓名"]` | `name` 的值为 `"李四"`。
| 移除一个键值对 | `:= 未定义` | `map["姓名"] := 未定义` | `map` 现在仅包含一个键值对。

## 内置函数

| 内置函数（汉字） | 内置函数（英文） | 解释                                            | 示例用法
| --------------- | --------------- | ---------------------------------------------- | -------------
| `类型()`          | `type()`          | 返回对象的类型名称                           | `type := 类型("姓名")`
| `输入()`          | `input()`         | 提示并获取用户输入                           | `x := 输入("姓名")`
| `输出()`          | `output()`        | 输出变量或者数据                             | `输出(x)`
| `整数()`          | `int()`           | 将指定数据转换为系统整数                      | `x := 整数(输入("系统整数"))`
| `任意整数()`      | `bigint()`        | 将指定数据转换为任意精度整数                  | `x := 任意整数(输入("任意整数"))`
| `字节()`          | `byte()`          | 将指定数据转换为字节                         | `x := 字节(输入("任意字母"))`
| `字符()`          | `char()`          | 将指定数据转换为字符                         | `x := 字符(输入("任意汉字"))`
| `字节串()`        | `bytes()`         | 将指定数据转换为字节串                       | `x := 字节串(123)`
| `字符串()`        | `string()`        | 将指定数据转换为字符串                       | `x := 字符串(1)`
| `浮点数()`        | `float()`         | 将指定数据转换为浮点数                       | `x := 浮点数(输入("浮点数"))`
| `任意浮点数()`    | `big.Float()`      | 将指定数据转换为任意精度浮点数                | `x := 任意浮点数(输入("浮点数"))`
| `任意小数()`      | `big.Rat()`    | 将指定数据转换为任意精度小数(有理数)                  | `x := 任意小数(输入("任意十进制小数"))`
| `退出()`          | `exit()`          | 退出算法执行                                 | `退出()`
| `终止()`          | `abort()`         | 终止算法执行                                 | `终止()`
| `执行()`          | `execute()`       | 执行一个系统动作                             | `执行("拍手")`
| `长度()`          | `len()`           | 返回给定数据的长度或数据项数量                | `长度(s)`
| `转储()`          | `dump()`          | 将给定数据按可执行反序列化的格式转为字符串     | `转储([1, 2, 3])`
| `装载()`          | `load()`          | 将给定的字符串执行反序列化操作                | `装载("[1, 2, 3]")`
| `断言()`          | `assert()`        | 断言给定的逻辑表达式是否为真；假时终止程序运行 | `断言(x == 3)`

## 内置模块

`math`数学包默认导入, 可以直接使用:

```
算始 任意底的对数
    // 真数
    p := 浮点(输入("真数"))
    // 底数
    b := 浮点(输入("底数"))

    // 利用换底公式计算 p 对 b 的对数
    x := math.Log2(p) / math.Log2(b)
    输出(x)
算终
```

对应的凹语言:

```
import "math"

func main {
    任意底的对数()
}

func 任意底的对数 {
    // 真数
    p := 浮点(输入("真数"))
    // 底数
    b := 浮点(输入("底数"))

    // 利用换底公式计算 p 对 b 的对数
    x := math.Log2(p) / math.Log2(b)
    输出(x)
}
```

## 关键字的对应

- break: 跳出
- case: 岔道
- const: 常量/定义
- continue: 继续
- default: 主道
- defer: 押后
- else: 若否
- for: 当始/当终
- func: 算始/算终, 函始/函终
- global: 全局
- if: 若始/若另/若终
- import: 引入
- map: 字典
- return: 返回
- struct: 类始/类终
- switch: 岔始/岔终

内置具名对象的对应:

- nil: 未定义
- true/false: 真/假

